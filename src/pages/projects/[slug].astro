---
import Layout from '../../layouts/Layout.astro';
import { projects } from '../../data/projects';

export function getStaticPaths() {
  return projects.map((project) => ({
    params: { slug: project.slug },
    props: { project },
  }));
}

const { project } = Astro.props;
---

<Layout>
  <main>
    <div class="container">
      <a href={`/portfolio/${project.categorySlug}`} class="back-link">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 12H5"/><path d="M12 19l-7-7 7-7"/></svg>
        Back to {project.categorySlug.replace('-', ' ').replace(/\b\w/g, c => c.toUpperCase())}
      </a>
      
      <article class="project-details">
        {!['3d-modeling', 'graphic-design'].includes(project.categorySlug) && (
          <div class="video-wrapper">
            {project.videoUrl ? (
              <iframe 
                width="100%" 
                height="562" 
                src={`https://www.youtube.com/embed/${project.videoUrl.split('/').pop()}`} 
                title={project.title} 
                frameborder="0" 
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
                allowfullscreen
              ></iframe>
            ) : (
              <div class="no-video">Video coming soon</div>
            )}
          </div>
        )}

        
        <div class="content">
          <h1>{project.title}</h1>
          <div class="meta-info">
            <p class="tools"><strong>Tools Used:</strong> {project.toolsUsed}</p>
          </div>
          <p class="description">{project.fullDescription}</p>
        </div>

        {project.categorySlug !== 'audio-editing' && (
          <div class="gallery">
            <h2>Project Gallery</h2>
            <div class="gallery-grid">
              {project.images && project.images.length > 0 ? project.images.map((image, index) => (
                <div class="image-item">
                  <img src={image} alt={`${project.title} - Image ${index + 1}`} loading="lazy" />
                </div>
              )) : (
                <p class="no-images">Coming soon...</p>
              )}
            </div>
          </div>
        )}
      </article>
    </div>
  </main>

  <!-- Lightbox Modal -->
  <div id="lightbox" class="lightbox">
    <span class="close-lightbox">&times;</span>
    <img class="lightbox-content" id="lightbox-img" src="" alt="Enlarged project image" />
  </div>
</Layout>

<script>
  const lightbox = document.getElementById('lightbox');
  const lightboxImg = document.getElementById('lightbox-img') as HTMLImageElement;
  const galleryImages = document.querySelectorAll('.image-item img');
  const closeBtn = document.querySelector('.close-lightbox');

  if (lightbox && lightboxImg) {
    galleryImages.forEach(img => {
      (img as HTMLElement).style.cursor = 'pointer';
      (img as HTMLElement).onclick = function() {
        lightbox.style.display = "flex";
        lightboxImg.src = (this as HTMLImageElement).src;
        document.body.style.overflow = 'hidden'; // Prevent scrolling when open
      }
    });

    const closeLightbox = () => {
      lightbox.style.display = "none";
      document.body.style.overflow = 'auto'; // Restore scrolling
    };

    if (closeBtn) {
      (closeBtn as HTMLElement).onclick = closeLightbox;
    }

    lightbox.onclick = (e) => {
      if (e.target !== lightboxImg) {
        closeLightbox();
      }
    };

    document.addEventListener('keydown', (e) => {
      if (e.key === "Escape") {
        closeLightbox();
      }
    });
  }
</script>

<style>
  main {
    margin: auto;
    padding: 2rem 1rem;
    width: 1000px;
    max-width: calc(100% - 2rem);
    color: white;
  }

  .container {
    animation: fadeIn 0.5s ease-out;
  }

  .back-link {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    color: #a1a1aa;
    text-decoration: none;
    font-size: 1rem;
    margin-bottom: 2rem;
    transition: color 0.2s;
  }

  .back-link:hover {
    color: white;
  }

  .video-wrapper {
    width: 100%;
    aspect-ratio: 16 / 9;
    border-radius: 1rem;
    overflow: hidden;
    margin-bottom: 2rem;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    border: 1px solid #333;
    background: #000;
  }

  .no-video {
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100%;
    color: #a1a1aa;
    font-size: 1.2rem;
  }

  iframe {
    width: 100%;
    height: 100%;
    display: block;
  }

  h1 {
    font-size: 3rem;
    font-weight: 700;
    margin-bottom: 1.5rem;
    background: linear-gradient(90deg, #fff, #ccc);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  .meta-info {
    margin-bottom: 2rem;
    padding: 1rem;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 0.5rem;
    border: 1px solid rgba(255, 255, 255, 0.1);
  }

  .tools {
    font-size: 1.1rem;
    color: rgb(var(--accent-light));
    margin: 0;
  }

  .description {
    font-size: 1.2rem;
    line-height: 1.8;
    color: #d1d5db;
    max-width: 65ch;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .gallery {
    margin-top: 4rem;
  }

  .gallery h2 {
    font-size: 2rem;
    font-weight: 700;
    margin-bottom: 2rem;
    color: white;
  }

  .gallery-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 1.5rem;
  }

  .image-item {
    border-radius: 0.5rem;
    overflow: hidden;
    transition: transform 0.3s ease;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    background: #1a1a1a;
  }

  .image-item:hover {
    transform: scale(1.02);
  }

  .image-item img {
    width: 100%;
    height: auto;
    display: block;
  }


  .no-images {
    color: #a1a1aa;
    font-style: italic;
  }

  /* Lightbox Styles */
  .lightbox {
    display: none;
    position: fixed;
    z-index: 9999;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.95);
    backdrop-filter: blur(5px);
    cursor: pointer;
    align-items: center;
    justify-content: center;
  }

  .lightbox-content {
    max-width: 90%;
    max-height: 90vh;
    object-fit: contain;
    border-radius: 0.25rem;
    box-shadow: 0 0 30px rgba(0,0,0,0.5);
    animation: zoom 0.3s ease-out;
    cursor: default;
  }

  @keyframes zoom {
    from {transform: scale(0.9); opacity: 0;}
    to {transform: scale(1); opacity: 1;}
  }

  .close-lightbox {
    position: absolute;
    top: 20px;
    right: 30px;
    color: white;
    font-size: 40px;
    font-weight: 300;
    transition: 0.3s;
    cursor: pointer;
    z-index: 10000;
    line-height: 1;
  }

  .close-lightbox:hover {
    color: #ccc;
    transform: scale(1.1);
  }
</style>

